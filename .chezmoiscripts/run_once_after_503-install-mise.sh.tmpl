#!/usr/bin/env bash

{{ if eq .chezmoi.os "linux" -}}

set -euo pipefail

# Pretty print functions
info()    { echo -e "\033[1;34m[INFO]\033[0m $*"; }
warn()    { echo -e "\033[1;33m[WARN]\033[0m $*"; }
error()   { echo -e "\033[1;31m[ERROR]\033[0m $*"; }
success() { echo -e "\033[1;32m[SUCCESS]\033[0m $*"; }

info "Installing Mise"

if [ ! -x "$HOME/.local/bin/mise" ]; then
  curl -fsSL https://mise.run | sh
else
  warn "Mise already installed"
fi

# PATH correto para ambiente não-interativo
export PATH="$HOME/.local/bin:$HOME/.local/share/mise/shims:$PATH"

# Zsh completions
mkdir -p "$HOME/.local/share/zsh/site-functions"
"$HOME/.local/bin/mise" completion zsh \
  > "$HOME/.local/share/zsh/site-functions/_mise"

info "Installing tool versions via mise"
mise install -y

info "Running mise doctor"
mise doctor

success "Mise installation completed"

{{ end -}} # Linux

# Diagnostics (executam só se tudo deu certo)
success "Node path: $(command -v node)"
success "Node version: $(node -v)"
success "NPM path: $(command -v npm)"
success "NPM version: $(npm -v)"
success "Mise version: $(mise --version)"

# vim: filetype=bash


