#!/usr/bin/env bash

{{ if eq .chezmoi.os "linux" -}}

set -euo pipefail

# Pretty print functions
info()    { echo -e "\033[1;34m[INFO]\033[0m $*"; }
warn()    { echo -e "\033[1;33m[WARN]\033[0m $*"; }
error()   { echo -e "\033[1;31m[ERROR]\033[0m $*"; }
success() { echo -e "\033[1;32m[SUCCESS]\033[0m $*"; }

# ----------------------------
# Ubuntu
# ----------------------------
{{ if eq .chezmoi.osRelease.id "ubuntu" }}

info ">>> Install dependencies Nvim (Ubuntu)"

sudo apt-get install -y ninja-build \
  gettext \
  libtool \
  libtool-bin \
  autoconf \
  automake \
  cmake \
  g++ \
  pkg-config \
  unzip \
  curl \
  doxygen


{{ end }}

# ----------------------------
# Arch / EndeavourOS / CachyOS
# ----------------------------
{{ if (or (eq .chezmoi.osRelease.id "endeavouros") (eq .chezmoi.osRelease.id "cachyos")) }}

info ">>> Install dependencies Nvim (Arch)"


{{ end }}

# ----------------------------
# Remove previous Neovim installations
# ----------------------------

info ">>> Remove previous Neovim installations"

if [ -d $HOME/.cache/nvim/ ]; then 
  sudo rm -r $HOME/.cache/nvim 
fi 
if [ -d $HOME/.local/share/nvim/ ]; then 
  sudo rm -r $HOME/.local/share/nvim 
fi
if [ -d /usr/local/share/nvim/ ]; then
  sudo rm -r /usr/local/share/nvim 
fi
if [ -d $HOME/.local/src/neovim ]; then 
  sudo rm -r $HOME/.local/src/neovim 
fi
if [ -d $HOME/.local/state/nvim ]; then 
  sudo rm -r $HOME/.local/state/nvim 
fi
if [ -f /usr/local/bin/nvim ]; then 
  sudo rm /usr/local/bin/nvim 
fi

# ----------------------------
# Build neovim
# ----------------------------
info ">>> Build Neovim from source"

git clone https://github.com/neovim/neovim $HOME/.local/src/neovim
cd $HOME/.local/src/neovim
make distclean 
make CMAKE_BUILD_TYPE=RelWithDebInfo CMAKE_INSTALL_PREFIX=$HOME/.local
make install

success ">>> Neovim build process finished successfully"

{{ end -}}

# vim: filetype=bash
