#!/usr/bin/env bash
# vim: filetype=bash

{{-  if .work.instivo }}
{{ if eq .chezmoi.os "linux" -}}
{{ if (or (eq .chezmoi.osRelease.id "endeavouros") (eq .chezmoi.osRelease.id "cachyos")) }}
set -euo pipefail

# Pretty print functions
info()    { echo -e "\033[1;34m[INFO]\033[0m $*"; }
warn()    { echo -e "\033[1;33m[WARN]\033[0m $*"; }
error()   { echo -e "\033[1;31m[ERROR]\033[0m $*"; }
success() { echo -e "\033[1;32mâœ… $*\033[0m"; }

# ============================================
# 1. Installing openvpn3
# ============================================
AUR_INSTALLER="yay"
if command -v "paru" > /dev/null; then
	AUR_INSTALLER="paru"
fi

if ! command -v "openvpn3" > /dev/null; then
	info "Installing gdbuspp + openvpn3"
	info "Installing gdbuspp"
	cd /tmp
	$AUR_INSTALLER -G gdbuspp
	cd gdbuspp/
	cp ~/.local/build/gdbuspp/PKGBUILD .
	makepkg -sri
	rm -rf /tmp/gdbuspp/
	success "gdbuspp installed"

	info "Installing openvpn3"
	$AUR_INSTALLER -Sy --noconfirm --needed openvpn3
	success "openvpn3 installed"
fi

if ! command -v "openvpn3" > /dev/null; then
	warn "Installing gdbuspp-git and openvpn3-git"
	$AUR_INSTALLER -Sy --noconfirm --needed gdbuspp-git openvpn3-git
	success "openvpn3-git installed"
fi

{{ end -}}
{{ end -}}
{{ end -}}
