#!/usr/bin/env bash
# vim: filetype=bash

set -euo pipefail

# Pretty print functions
info()    { echo -e "\033[1;34m[INFO]\033[0m $*"; }
warn()    { echo -e "\033[1;33m[WARN]\033[0m $*"; }
error()   { echo -e "\033[1;31m[ERROR]\033[0m $*"; }
success() { echo -e "\033[1;32mâœ… $*\033[0m"; }

{{ if (or (eq .chezmoi.osRelease.id "endeavouros") (eq .chezmoi.osRelease.id "cachyos")) }}

info "Installing Devops core packages"
sudo pacman -Syu --noconfirm --needed {{ range .packages.linux.arch.devops.core }} {{.}}{{end}}
success "Installed Devops core packages"


if type -P paru >/dev/null 2>&1; then
    info "Installing Devops AUR packages with paru"
    paru -Syu --noconfirm --needed {{ range .packages.linux.arch.devops.aur }} {{.}}{{ end }}
    success "Installed Devops AUR packages"
elif type -P yay >/dev/null 2>&1; then
    info "Installing Devops AUR packages with yay"
    yay -Syu --noconfirm --needed {{ range .packages.linux.arch.devops.aur }} {{.}}{{ end }}
    success "Installed Devops AUR packages"
fi

sudo usermod -aG docker ${USER}
newgrp docker
# sudo systemctl start docker.service

{{ else }}

error "This script is only for Arch based systems. Exiting..."

{{ end }}
